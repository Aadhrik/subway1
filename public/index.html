<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Home Dashboard</title>
    <meta name="description" content="Smart Home Dashboard">
    <meta name="theme-color" content="#0a0a0a">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@200;300;400;500;600;700&family=VT323&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Gridstack CSS -->
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-extra.min.css" rel="stylesheet">
    
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="dashboard.css">
    
    <!-- Widget Styles -->
    <link rel="stylesheet" href="widgets/subway/subway.css">
    <link rel="stylesheet" href="widgets/weather/weather.css">
    <link rel="stylesheet" href="widgets/timepiece/timepiece.css">
    <link rel="stylesheet" href="widgets/flip-clock/flip-clock.css">
</head>

<body>
    <div id="dashboard"></div>

    <!-- Gridstack JS -->
    <script src="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-all.min.js"></script>
    
    <!-- Core Framework -->
    <script src="widgets/widget-base.js"></script>
    <script src="dashboard.js"></script>
    
    <!-- Widgets -->
    <script src="widgets/subway/subway-widget.js"></script>
    <script src="widgets/weather/weather-widget.js"></script>
    <script src="widgets/timepiece/timepiece-widget.js"></script>
    <script src="widgets/flip-clock/flip-clock-widget.js"></script>
    
    <!-- Initialize Dashboard -->
    <script>
        // Detect if we're on a 16:10 tablet (like Xiaomi Redmi Pad 2)
        const isTablet16x10 = (() => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            const aspect = w / h;
            return aspect >= 1.5 && aspect <= 1.7 && w >= 1200;
        })();
        
        // Create dashboard with auto-calculated dimensions
        const dashboard = new Dashboard({
            title: 'Home Dashboard',
            showHeader: true,
            columns: 12,
            cellHeight: 'auto', // Auto-calculate based on screen
            margin: 'auto'      // Auto-calculate based on screen
        });
        
        // Widget sizes optimized for 8-row grid on 16:10 tablet
        // Layout: Subway (8 cols, left, full height) + Weather (4 cols, right, full height)
        const widgetSizes = isTablet16x10 ? {
            subway: { w: 8, h: 8, x: 0, y: 0, minW: 4, minH: 4 },
            weather: { w: 4, h: 8, x: 8, y: 0, minW: 3, minH: 4 },
            timepiece: { w: 4, h: 4, x: 0, y: 8, minW: 3, minH: 3 },
            flipClock: { w: 4, h: 4, x: 4, y: 8, minW: 3, minH: 2 }
        } : {
            weather: { w: 4, h: 5, x: 0, y: 0, minW: 3, minH: 4 },
            subway: { w: 8, h: 5, x: 4, y: 0, minW: 4, minH: 4 },
            timepiece: { w: 4, h: 4, x: 0, y: 5, minW: 3, minH: 3 },
            flipClock: { w: 5, h: 3, x: 4, y: 5, minW: 4, minH: 3 }
        };
        
        // Register available widgets (for the "Add Widget" picker)
        dashboard.registerWidget('weather', WeatherWidget, {
            displayName: 'Weather',
            icon: 'üå§',
            gridW: widgetSizes.weather.w,
            gridH: widgetSizes.weather.h,
            locationName: 'New York',
            latitude: 40.7128,
            longitude: -74.0060
        });
        
        dashboard.registerWidget('subway', SubwayWidget, {
            displayName: 'Subway',
            icon: 'üöá',
            gridW: widgetSizes.subway.w,
            gridH: widgetSizes.subway.h,
            safetyBufferMinutes: 2
        });

        dashboard.registerWidget('timepiece', TimepieceWidget, {
            displayName: 'Watch',
            icon: '‚åö',
            gridW: widgetSizes.timepiece.w,
            gridH: widgetSizes.timepiece.h
        });

        dashboard.registerWidget('flip-clock', FlipClockWidget, {
            displayName: 'Flip Clock',
            icon: 'üïê',
            gridW: widgetSizes.flipClock.w,
            gridH: widgetSizes.flipClock.h,
            showSeconds: true
        });
        
        // Initialize
        dashboard.init('#dashboard');
        
        // Add default widgets - only if they should be shown (weren't deleted)
        // On first load, all widgets are shown. After that, only saved ones appear.
        
        if (dashboard.shouldShowWidget('weather')) {
            dashboard.addWidget(new WeatherWidget({
                locationName: 'New York',
                latitude: 40.7128,
                longitude: -74.0060
            }), widgetSizes.weather);
        }
        
        if (dashboard.shouldShowWidget('subway')) {
            dashboard.addWidget(new SubwayWidget({
                safetyBufferMinutes: 2
            }), widgetSizes.subway);
        }

        if (dashboard.shouldShowWidget('timepiece')) {
            dashboard.addWidget(new TimepieceWidget({}), widgetSizes.timepiece);
        }

        if (dashboard.shouldShowWidget('flip-clock')) {
            dashboard.addWidget(new FlipClockWidget({
                showSeconds: true
            }), widgetSizes.flipClock);
        }
        
        // Log tablet detection
        if (isTablet16x10) {
            console.log('[Dashboard] 16:10 tablet detected - using optimized layout');
        }
    </script>
</body>

</html>
